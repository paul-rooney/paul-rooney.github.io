<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">

  <title>Thoughts &middot; Paul Rooney</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Arsenal:ital,wght@0,400;0,700;1,400;1,700&family=DM+Mono:wght@300&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./reset.css">
  <link rel="stylesheet" href="./typography.css">
  <link rel="stylesheet" href="./styles.css">

  <meta name="description" content="This is the personal website of Paul Rooney, a front-end web developer and designer based in Belfast, Northern Ireland">
  <link rel="canonical" href="https://www.paul-rooney.github.io">

  <!-- <link rel="icon" href="/favicon.ico">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml"> -->
  <meta name="theme-color" content="#C7584B" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#D66B74" media="(prefers-color-scheme: dark)">
</head>

<body class="body">
  <nav class="nav">
    <ul class="nav__menu">
      <li class="nav__item">
        <a href="./" class="nav__link">Projects</a>
      </li>
      <li class="nav__item">
        <a href="./thoughts" class="nav__link">Thoughts</a>
      </li>
      <li class="nav__item">
        <a href="./cv" class="nav__link">CV</a>
      </li>
    </ul>
  </nav>

  <header class="header">
    <h1 class="page__heading">Paul Rooney</h1>
    <h2 class="page__subheading">
      <span class="page__subheading__highlight">Front-end developer</span> in <span class="page__subheading__highlight">Belfast</span>
    </h2>
  </header>

  <!-- Follow this format:

    main
      section
        .section__heading: h2 or header for a group of elements
        .section__content: article
          within any article use a new header and main

  -->

  <main class="main">
    <article class="section__content">
      <header class="section__header">
        <h2 class="section__heading">Building an email newsletter</h2>
        <span><em>metadata</em></span>
      </header>
      <main>
        <h3 class="subsection__heading">Introduction</h3>
        <p>This project came about after being asked by my marketing department (personnel: 1) to push the company’s latest publication into one email newsletter for distribution to a few thousand subscribers. The original template was designed (and always intended) to be a simple digest &mdash; a selection of around fifteen editorial pieces that would theoretically drive traffic to our site.</p>
        <p>Enter: advertisers.</p>
        <p>They were promised that they’d feature in every newsletter going forward, and so I found that I now had upwards of forty editorial-style ads to include in our newsletters. Clearly it would be bad practice to pelt our subscribers with this many ads and call it a day &mdash; I had to include our own editorial in there, too.</p>
        <p>With the original template, I would manually upload the featured images and link them, along with the headlines, to the article on our site. Now, I’d have to do this for over fifty articles and ads. Extremely time-consuming, and not a good use of resources. So, I started building a template that would pull in the most recent articles using the WordPress REST API and spit out a Campaign Monitor-ready template.</p>

        <h3 class="subsection__heading">Campaign Monitor (CM)</h3>
        <p>Designing custom templates in CM is relatively straightforward &mdash; provided you have a solid HTML email that works well across the roughly ten thousand email clients, all that you need to add are a few custom tags: things like <code>&lt;repeater&gt;</code>, <code>&lt;layout&gt;</code>, <code>&lt;multiline&gt;</code>, and <code>&lt;singleline&gt;</code>. To make an image editable you just add the <code>&lt;editable&gt;</code> attribute to the tag itself.</p>
        <p>Luckily, I had already built a solid HTML template to work with, and once I had added the requisite CM markup, I was ready to start working on the JavaScript.</p>

        <h3 class="subsection__heading">JavaScript (JS) and the REST API</h3>
        <p>The objective was straightforward to start with &mdash; get a specified number of recent posts (or a specific category) from a specified WordPress site belonging to us. I wanted a few things from each post so that I could inject it into the HTML template:</p>
        <ul>
          <li>the post category;</li>
          <li>the post title;</li>
          <li>the post excerpt;</li>
          <li>the URL of the post;</li>
          <li>the featured image for the post; and</li>
          <li>any associated tags.</li>
        </ul>
        <p>To get these, I created a function <code>getPosts()</code> that accepts four parameters:</p>
        <ul>
          <li>the domain URL;</li>
          <li>the number of posts to fetch;</li>
          <li>(optionally) the name of a specific category to fetch from; and</li>
          <li>(optionally) the name of the publication to update the <code>&lt;title&gt;</code> tag with.</li>
        </ul>
        <p>Here’s what that looks like:</p>
        <pre>function getPosts(domain, number_of_posts, report, publication) {
  let str;
  let arr = [];

  if (report === '') {
    str = `${domain}/wp-json/wp/v2/posts?per_page=${number_of_posts}`;
  } else {
    str = `${domain}/wp-json/wp/v2/posts?categories=${report}`;
  }

  fetch(str, { credentials: 'same-origin' })
    .then((response) => response.json())
    .then((posts) => {
      posts.forEach((post, index) => {
        Promise.all([
          fetch(`${domain}/wp-json/wp/v2/media/${post.featured_media}`),
          fetch(`${domain}/wp-json/wp/v2/categories/${post.categories[0]}`),
        ])
          .then((responses) => {
            return Promise.all(
              responses.map((response) => {
                return response.json();
              })
            );
          })
          .then((response) => {
            let postObject = {
              category: response[1].name,
              excerpt: truncateExcerpt(post.excerpt.rendered),
              img_url: response[0].source_url,
              link: post.link,
              tags: post.tags,
              title: post.title.rendered,
            };

            buildDOM(postObject);

            if ((report && index === response.length - 1) || (!report && index === number_of_posts - 1)) {
              enableDownloadButton();
              updateDocumentTitle(publication);
              updateDOM(publication);
            }
          })
          .catch((err) => console.warn(err));
      });
    })
    .catch((err) => console.warn(err));
}
        </pre>
        <p>The first thing it does is creates two empty variables: <code>str</code> and <code>arr</code> (guess what type of data they’re supposed to hold…). Then, it checks if a category was specified and passed in as an argument. If it’s included, <code>str</code> is set to the URL of the domain to search for that posts in that category. If it’s not included, <code>str</code> is set to the URL of our domain along with the number of recent posts we’ve requested.</p>
        <p>Next, it takes that URL and runs a fetch request, returning a JSON object which it can then loop through. This is where it gets a bit messy &mdash; this is absolutely not the cleanest or neatest way of doing this, but it’s working as I need it to, so I can live with it.
      </main>
    </article>
  </main>

  <footer class="footer">
    <p><small>&copy; Paul Rooney <span id="date"></span>. All rights reserved.</small></p>
  </footer>

  <script async>
    document.body.querySelector('#date').textContent = new Date().getFullYear();
  </script>
</body>
</html>
